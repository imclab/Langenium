{"ts":1363623158409,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"/*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n\tObjects\n\tThis defines object methods and proxies the sub class functions \n\t\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*/\n\nvar\tcache = [],\n\t\tworld_map = [];\n\nfunction loadObject(instruction) {\n\tvar loader = new THREE.JSONLoader();\n\tvar cacheIndex = -1;\n\tcache.forEach(function(cachedObject, index){ if (instruction.url == cachedObject.url) { cacheIndex = index;} });\n\tvar  x = instruction.position.x,\n\t\ty = instruction.position.y,\n\t\tz = instruction.position.z,\n\t\tscale = instruction.scale, \n\t\ttype = instruction[\"class\"]; \n\t\n\tif (cacheIndex >= 0) {\n\t\tvar cachedObject = cache[cacheIndex];\n\t\tmesh = makeObjectMesh(type, cachedObject.geometry, cachedObject.materials, x, y, z , scale);\n\t\trenderObject(mesh, type, instruction);\n\t}\n\telse {\n\t\tloader.load(instruction.url, function(geometry, materials) {\n\t\t\tmesh = makeObjectMesh(type, geometry, materials, x, y, z , scale);\n\t\t\tvar cachedObject = { url: instruction.url, geometry: geometry, materials: materials};\n\t\t\tcache.push(cachedObject);\t\n\t\t\trenderObject(mesh, type, instruction);\n\t\t});\n\t}\n}\nfunction makeObjectMesh(objectType, geometry, materials, x, y, z, scale) {\n\tvar useVertexOverrides = false;\n\tif ((objectType != \"ship\")&&(objectType != \"players\")&&(objectType != \"bot\")) {\n\t\tuseVertexOverrides = true;\n\n\t}\n\tmaterials.forEach(function(material, index){\n\n\t\tif (material.name == \"Metal\") {\n\n\t\t\t\tmaterials[index].vertexColors = THREE.VertexColors;\n\t\t}\n\t\tif (material.name == \"Light-Metal\") {\n\t\t\t\tmaterials[index].vertexColors = THREE.VertexColors;\n\t\t}\n\t\tif (material.name == \"Red-Metal\") {\n\t\t\t\tmaterials[index].vertexColors = THREE.VertexColors;\n\t\t}\n\t\tif (material.name == \"Glass\") {\n\t\t\t\tmaterials[index].transparent = true;\n\t\t\t\tmaterials[index].opacity = 0.8;\n\t\n\t\t\t\tmaterials[index].color.r = .1;\n\t\t\t\tmaterials[index].color.g =  .5; \n\t\t\t\tmaterials[index].color.b =  .9;\n\t\t\n\t\t\t\tmaterials[index].vertexColors = THREE.VertexColors;\n\n\t\t}\n\t\tif (material.name == \"Dark-Glass\") {\n\t\t\tmaterials[index].shading = THREE.FlatShading;\n\t\t\tmaterials[index].transparent = true;\n\t\t\tmaterials[index].opacity = 0.95;\n\n\t\t\tmaterials[index].vertexColors = THREE.VertexColors;\n\t\t\t\n\t\t}\n\t});\n\tgeometry.faces.forEach(function(face,index){\n\t\tif ((materials[face.materialIndex].name == \"Red-Metal\")&&(useVertexOverrides == true)) {\n\t\t\tface.vertexColors[0] =  new THREE.Color( 0x440000 );\n\t\t\tface.vertexColors[1] =  new THREE.Color( 0x440000 );\n\t\t\tface.vertexColors[2] =  new THREE.Color( 0x550000);\n\t\t\tface.vertexColors[3] =  new THREE.Color( 0x440000 );\n\t\t}\n\t\tif ((materials[face.materialIndex].name == \"Metal\")&&(useVertexOverrides == true)) {\n\t\t\tface.vertexColors[0] =  new THREE.Color( 0x333333 );\n\t\t\tface.vertexColors[1] =  new THREE.Color( 0x222222 );\n\t\t\tface.vertexColors[2] =  new THREE.Color( 0x333333);\n\t\t\tface.vertexColors[3] =  new THREE.Color( 0x333333 );\n\t\t}\n\t\tif ((materials[face.materialIndex].name == \"Light-Metal\")&&(useVertexOverrides == true)) {\n\t\t\tface.vertexColors[0] =  new THREE.Color( 0x666666 );\n\t\t\tface.vertexColors[1] =  new THREE.Color( 0x444444 );\n\t\t\tface.vertexColors[2] =  new THREE.Color( 0x666666);\n\t\t\tface.vertexColors[3] =  new THREE.Color( 0x666666 );\n\t\t}\n\t\tif ((materials[face.materialIndex].name == \"Dark-Glass\")&&(useVertexOverrides == true)) {\n\t\t\tface.vertexColors[0] =  new THREE.Color( 0x112233 );\n\t\t\tface.vertexColors[1] =  new THREE.Color( 0x112233 );\n\t\t\tface.vertexColors[2] =  new THREE.Color( 0x116699);\n\t\t\tface.vertexColors[3] =  new THREE.Color( 0x113355 );\n\t\t}\n\t});\n\tobject = new THREE.Mesh(geometry, new THREE.MeshFaceMaterial( materials ) );\n\tobject.geometry.computeBoundingBox();\n\tobject.name = objectType;\n\tobject.position.set(x, y, z);\n\tobject.scale.set(scale, scale, scale);\n\tobject.matrixAutoUpdate = true;\n\tobject.updateMatrix();\n\tobject.geometry.colorsNeedUpdate = true;\n\treturn object;\n}\nfunction renderObject(mesh, type, instruction) {\n\tmesh.uid = instruction.id;\n\tvar  x = instruction.position.x,\n\t\t\ty = instruction.position.y,\n\t\t\tz = instruction.position.z,\n\t\t\tscale = instruction.scale;\n\n\tif (type == \"environment\") { \n\t\tworld_map.push(mesh);\n\t\tscene.add(world_map[world_map.length-1]);\n\t}\n\tif (type == \"players\") {\n\t\tplayer = mesh;\n\t\tplayer.bullets = [];\n\t\tplayer.moveInterval = new Date().getTime();\n\t\tplayer.username = instruction.username;\n\t\tplayer.rotation.y = instruction.position.rY;\n\t\tplayer.material.materials.forEach(function(material,index){\n\t\t\tplayer.material.materials[index].morphTargets = true;\n\t\t});\n\t\t\n\t\tplayer.velocity = 0;\n\t\t\n\t\tplayer.add(camera);\n\t\tscene.add(player);\n\t\tships.push(player);\n\n\t}\n\tif (type == \"bot\") {\n\t\tvar bot = mesh;\n\t\tbot.bullets = [];\n\t\tbot.id = instruction.id;\n\t\tbot.type = instruction.shipType;\n\t\tbot.rotation.y = instruction.position.rotationY;\n\t\tbot.add(botScope());\n\t\tbots.push(bot);\n\t\tscene.add(bots[bots.length-1]);\n\t}\n}"]],"start1":0,"start2":0,"length1":0,"length2":5354}]],"length":5354}
